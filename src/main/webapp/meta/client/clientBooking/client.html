<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Client website</title>
  <link href="clientStyle.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.cdnfonts.com/css/kiona-2" rel="stylesheet" type="text/css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body onload = "getadmin(), getcrew()">
<div class="container">
  <header>
    <div class="page-title">
      <div class="text">Hello Client Shotmaniac2, Welcome to your Bookings</div>
      <hr>
      <div class="logout">
        <img src="../../Brand_Identity/images/Logo/Shotmaniacs_Logo_White_MT.png" alt="logout">
      </div>
    </div>
    <div class="navigation">
      <div class="title-bar">
        <div class="left-heading">
          <div class="heading">
            <h1 id ="header-name">Booking Name</h1>
          </div>
          <div class ="navigate"><a href="dashboard.html"><span>My Bookings </span></a> /Booking details</div>
        </div>
        <div class="right-heading">
          <button class="labelButton" onclick="cancel()">Cancel</button>
        </div>
      </div>
    </div>
  </header>

  <nav>
    <div class="logo">
      <img src="../../Brand_Identity/images/Logo/Shotmaniacs_Logo_White_MT.png" alt="Shotmaniacs White Logo Without Text">
    </div>
    <div class="dash-box">
      <a href="applicationForm.html" target="_self">
        <div class="box" id="dashboard">
          <img id="icon-1" src="../../Brand_Identity/images/icons/" alt="">
          <label>New Booking</label>
        </div>
      </a>
      <a href="dashboard.html" target="_self">
        <div class="box" id="News">
          <img id="icon-2" src="../../Brand_Identity/images/icons/myBookingClient_Black.png" alt="">
          <label>My Bookings</label>
        </div>
      </a>
      <a href="../account/account.html" target="_self">
        <div class="box" id="calendar">
          <img id="icon-3" src="../../Brand_Identity/images/icons/black_user_icon.png" alt="">
          <label>Account</label>
        </div>
      </a>
      <a href="../../help/help.html" target="_self">
        <div class="box" id="booking">
          <img id="icon-4" src="../../Brand_Identity/images/icons/black_help_icon.png" alt="">
          <label>Help</label>
        </div>
      </a>
    </div>
  </nav>
  <main>
    <!-- On single Event -->
    <div class="event-name">
      <label class="name-label" for="event-name">Event Name</label>
      <input type="text" class="eventInput" id="event-name" placeholder="Input Event Name" readonly>
    </div>
    <div class="event-type">
      <label>Event Type</label>
      <input type="text" class="eventInput" id="event-type" placeholder="Input Event Type" readonly>
    </div>
    <div class="event-time">
      <label class="name-label" for="time-input">Event TIME</label>
      <input type="datetime-localtime" class="eventInput" id="time-input" placeholder="Input Event Time" readonly>
    </div>

    <div class="location">
      <label class="name-label" for="location-input">Location</label>
      <input type="text" class="eventInput" id="location-input" placeholder="Input Event Location" readonly>
    </div>
    <div class="booking-type">
      <label>Booking Type</label>
      <input type="text" class="eventInput" id="bookingtype-input" placeholder="Input Booking Type" readonly>
    </div>
    <div class="duration">
      <label class="name-label" for="duration-input">Duration</label>
      <input type="number" class="eventInput" id="duration-input" placeholder="Input Duration" readonly>
    </div>
    <div class="description">
      <label class="name-label" for="description-input">description</label>
      <input type="text" class="eventInput" id="description-input" placeholder="Input Description" readonly>
    </div>
  </main>
  <aside>
    <div>
    <div class = "members">
      <div class="admins">
        <div class="head">
          Administrators
        </div>
        <div class="users" id = "admin">
          <div class="user-box" onclick="displaydetail(this)">
            <p id = "admin-name">Name 1</p>
            <p class ="none-display" id = "admin-email"></p>
            <p class ="none-display"id = "admin-tel"></p>
          </div>
        </div>
      </div>

      <div class="crews">
        <div class="head">
          Crews
        </div>
        <div class="users" id ="crew">
          <div class="user-box" onclick="displaydetail(this)" >
            <p  id = "crew-name">Name 1</p>
            <p class ="none-display" id = "crew-email"></p>
            <p class ="none-display" id = "crew-tel"></p>
          </div>
          </div>
        </div>
      </div>
    </div>
    <div class="statistics">
      <div class="admin-funtion">
        <div class = "close" >
          <img id="admin-close" src="../../Brand_Identity/images/icons/arrowdown.png" >
        </div>
        <div class = "number">
          <label id ="number-admins"></label>
        </div>
        <div class = "reload">
          <img id="reload-admins"src="../../Brand_Identity/images/icons/reload.png" onclick="getadmin()">
        </div>
      </div>
      <div class="crew-funtion">
        <div class = "close" >
          <img id="crew-close"  src="../../Brand_Identity/images/icons/arrowdown.png">
        </div>
        <div class = "number">
          <label id ="number-crews"></label>
        </div>
        <div class = "reload">
          <img id="reload-crews" src="../../Brand_Identity/images/icons/reload.png" onclick="getcrew()">
        </div>
      </div>
    </div>
  </aside>
  <div id="details" class="hidden">
    <div id="exit-icon"><img src="../../Brand_Identity/images/icons/X-icon.png" onclick="cancelrequest()"></div>
    <div class ="details">
      <div class="employee-title">EMPLOYEE</div>
      <div class="employee-name">
        <label class="name-label" for="employee-name">NAME</label>
        <input type="text" class="employeeInput" id="employee-name" placeholder="" readonly>
      </div>
      <div class="employee-email">
        <label class="employee-email" for="employee-email">EMAIL</label>
        <input type="text" class="employeeInput" id="employee-email" placeholder="" readonly>
      </div>
      <div class="employee-tel">
        <label class="name-label" for="employee-tel">PHONE</label>
        <input type="text" class="employeeInput" id="employee-tel" placeholder="" readonly>
      </div>
    </div>
  </div>
  <div id="cancel-box" class="hidden" >
    <div class="cancel-header">
      <label>CANCEL BOOKING</label>
    </div>
    <div class="cancel-question">
      <label>Are you sure you want to cancel the"Booking's name" booking?</label>
    </div>
    <div class="cancel-reason">
      <label>Reason for cancellation(if applicable)</label>
      <div class="reason-input">
        <input type="text" id="reason-input"  name="id" >
      </div>
    </div>
    <div clas="confirm">
      <button class="cancel-booking" onclick="changetoterm()"> Cancel booking</button>
      <button class="cancel-request" onclick="cancelrequest()">Cancel</button>
    </div>
  </div>
  <div id="cancellation" class="hidden">
    <div class ="text-logo">
      <a href="dashboard.html"><img src="../../Brand_Identity/images/icons/X-icon.png"
              alt="x"></a>
    </div>
    <div class ="cancel-form-title">
      <div class ="logo-for-cancelform">
        <img src="../../Brand_Identity/images/Logo/Shotmaniacs_Logo_Black_ZT.png"
               alt="Shotmaniacs White Logo Without Text">
      </div>
      <label>CANCELLATION CONFIRMATION</label>
    </div>
    <div class="term">
      <label id ="label 1">Hi Client Shotmaniacs Group 2,</label>
      <br><br><label id ="label 2">Your cancellation request has been sent on June 20, 2023. We’re really sorry when this booking doesn’t work out for you anymore, but thank you so much for giving us a try.</label>
      <br><br><label id ="label 3">Make a mistake? Having second thoughts?<br>
      If you believe this cancellation is in error, please visit: <span>SHOTMANIACS.support</span> for more details.</label>
      <br><br><label id="label 4">You want to upload other new booking(s)?</label>
      <br><br><label id="label 5">Once again, thank you so much for being our customer.</label>

    </div>
  </div>
</div>
<div id="overlay" class="hidden"></div>
<script>
  window.addEventListener('beforeunload', function (event) {
    // Cancel the event to prevent the browser from closing immediately
    event.preventDefault();
    document.cookie ="booking_id =;  Path=/";
    return;
  });
  function parseCookie(cookieString) {
    const cookies = {};
    cookieString.split(';').forEach(cookie => {
      const [name, value] = cookie.trim().split('=');
      cookies[name] = decodeURIComponent(value);
    });
    return cookies;
  }

  const employee =[]

  const cookies = parseCookie(document.cookie);
  const id = cookies['booking_id'];
  const url = window.location.origin+"/shotmaniacs2/api/client/"+id;
  const url1 = window.location.origin+"/shotmaniacs2/api/client/"+id+"/admins";
  const url2 =  window.location.origin+"/shotmaniacs2/api/client/"+id+"/crews"
  fetch(url)
          .then(response => response.json())
          .then(data =>
          {
            document.getElementById("event-name").placeholder = `${data.name}`
            document.getElementById("header-name").innerHTML = data.name
            document.getElementById("event-type").placeholder = `${data.eventType}`
            let dateTime = new Date(data.date);
            const formattedDate = dateTime.toLocaleString('en-US', {
              hour: '2-digit',
              minute: '2-digit',
              hour12: false
            });
            document.getElementById("time-input").placeholder = formattedDate;
            document.getElementById("location-input").placeholder = `${data.location}`
            document.getElementById("duration-input").placeholder = `${data.duration}`
            document.getElementById("description-input").placeholder = `${data.description}`
          })
  function getadmin() {
    const admincontainer = document.getElementById("admin");
    const adminelement = admincontainer.firstElementChild.cloneNode(true);

    fetch(url1)
            .then(response => response.json())
            .then(data => {
                      while (admincontainer.firstChild) {
                        admincontainer.removeChild(admincontainer.firstChild);
                      }
                      document.getElementById("number-admins").innerHTML = data.length;
                      data.forEach(account => {
                        let userCopy = adminelement.cloneNode(true);

                        //TODO: Calculate amount of slots already taken.

                        //TODO: the line below probably allows stored code attacks. Needs fixing
                        userCopy.id = account.id;
                        userCopy.querySelector("#admin-name").innerHTML = account.username
                        console.log(account.username)
                        userCopy.querySelector("#admin-email").innerHTML = account.email
                        userCopy.querySelector("#admin-tel").innerHTML = account.tel
                        admincontainer.appendChild(userCopy)
                        employee[account.id]=account
                      })
                    }
            )
  }
  function getcrew() {
    const crewcontainer = document.getElementById("crew");
    const crewelement = crewcontainer.firstElementChild.cloneNode(true);

    fetch(url2)
            .then(response => response.json())
            .then(data => {
                      while (crewcontainer.firstChild) {
                        crewcontainer.removeChild(crewcontainer.firstChild);
                      }
                      document.getElementById("number-crews").innerHTML = data.length;
                      data.forEach(account => {
                        let userCopy = crewelement.cloneNode(true);

                        //TODO: Calculate amount of slots already taken.

                        //TODO: the line below probably allows stored code attacks. Needs fixing
                        userCopy.id = account.id;
                        userCopy.querySelector("#crew-name").innerHTML = account.username
                        userCopy.querySelector("#crew-email").innerHTML = account.email
                        userCopy.querySelector("#crew-tel").innerHTML = account.tel
                        crewcontainer.appendChild(userCopy);
                        employee[account.id]=account
                      })
                    }
            )
  }
  function displaydetail(element){
    var cancel = document.getElementById('details');
    var overlay = document.getElementById('overlay');
    cancel.classList.remove('hidden');
    overlay.classList.remove('hidden');
    document.getElementById("employee-name").placeholder = employee[element.id].username
    document.getElementById("employee-email").innerHTML = employee[element.id].email
    document.getElementById("employee-tel").placeholder = employee[element.id].tel
  }


  function cancel(){
    var cancel = document.getElementById('cancel-box');

    var overlay = document.getElementById('overlay');
    cancel.classList.remove('hidden');
    overlay.classList.remove('hidden');

  }
  function changetoterm(){
    const url = window.location.origin+"/shotmaniacs2/api/client/"+id;
    fetch(url, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json' // Set the appropriate content type
      },
      // You can include a request body if required
      // body: JSON.stringify(data)
    })
            .then(response => {
              if (!response.ok) {
                throw new Error('Error: ' + response.status);
              }
              return response; // Parse the response as JSON if needed
            })
            .then(data => {
              console.log('Delete successful', data);
              // Handle the response data or perform other actions
            })
            .catch(error => {
              console.error('Error:', error);
              // Handle any errors that occurred during the request
            });
    var cancellation = document.getElementById("cancellation");
    var cancel = document.getElementById('cancel-box');
    cancel.classList.add('hidden');
    cancellation.classList.remove('hidden');

  }
  function cancelrequest(){
    var cancel = document.getElementById('cancel-box');
    var overlay = document.getElementById('overlay');
    var detail = document.getElementById('details');
    cancel.classList.add('hidden');
    overlay.classList.add('hidden');
    detail.classList.add('hidden');
  }
  console.log(employee)

  /*filter*/


</script>
</body>
</html>