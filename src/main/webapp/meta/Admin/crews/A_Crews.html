<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Crews</title>
  <link href="A_Crews.css" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/kiona-2" rel="stylesheet">
  <link href="https://use.fontawesome.com/releases/v5.13.0/css/all.css"
        rel="stylesheet" type='text/css'>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body onload = "getAllCrews(), addCrew()">
<div class="container">
  <header>
    <div class="top">
      <i class="fas fa-user user-icon"></i>
      <p id="Username">Admin Shotmaniacs Group 2</p>
      <img id="LogOutIcon" src="./../../Brand_Identity/images/icons/white_Logout.png" alt="LogOut-Icon">
      <p id="LogOut">Log out</p>
    </div>
    <div class="search-area">
      <div class="left">
        <div class="image">
          <img src="./../../Brand_Identity/images/Logo/Shotmaniacs_Logo_Black_MT.png" alt="Shotmaniacs">
        </div>
        <div class="text">
          <span class="slogan">Make Every Shot Count</span>
        </div>
      </div>

      <div class="search">
        <label for="search"></label>
        <input type="text" class="input" id="search" placeholder="Search...">
        <button class="search-icon-btn">
        </button>
      </div>
    </div>

    <div class="navigation">
      <div class="box" id="img"><a href="./../../dashboard/A_Dashboard.html"></a></div>
      <div class="box"><a href="./../news/notifications.html" style="left: 35.3vw">Announcement</a></div>
      <div class="box"><a href="./../All_Bookings/bookings/A_bookings.html" style="left: 47.2vw">Bookings</a></div>
      <div class="box"><a href="./../crews/A_Crews.html" style="left: 58.2vw">Crews</a></div>
      <div class="box"><a href="./../All_Bookings/calendar/A_calendar.html" style="left: 67.5vw" hidden>Calendar</a></div>
    </div>
  </header>

  <main>
    <div class="main-container">
      <div class="heading" id="heading">
        <span style="padding-left: 28vw">
            <span class="booking-name-title">Crews</span>
        </span>
      </div>
      <div class="left-side" id="left-side">
        <div id="scrollbar">
          <div id="bar"></div>
        </div>
        <script>
          var scrollBar = document.getElementById("scrollbar");
          var bar = document.getElementById("bar");
          var leftSide = document.getElementById("left-side");
          leftSide.onscroll = function() {
            scrollIndicator()
          };

          function scrollIndicator() {
            var winScroll = leftSide.scrollTop;
            var height = leftSide.scrollHeight - leftSide.clientHeight;
            var scrolled = 0;
            if (height > 0) {
              scrollBar.style.height = (100 + (winScroll / height) * 100) + 'vh';
              scrolled = (winScroll / height) * 100;
            }
            bar.style.height = scrolled + "%";
          }
        </script>
        <div class="crews" id="crews" style="margin-left: 2vw; margin-top: 3vh">
        </div>
      </div>
      <div class="right-side">
        <div id="add-crew">
          <p>Add Crew</p>
        </div>
        <div id="adding-crew-here" style="margin-left: 1.5vh; margin-top: 5vh"></div>
      </div>
    </div>
  </main>
</div>
<script>
  window.addEventListener('beforeunload', function (event) {
    // Cancel the event to prevent the browser from closing immediately
    event.preventDefault();
  });

  function parseCookie(cookieString) {
    const cookies = {};
    cookieString.split(';').forEach(cookie => {
      const [name, value] = cookie.trim().split('=');
      cookies[name] = decodeURIComponent(value);
    });
    return cookies;
  }

  const cookies = parseCookie(document.cookie);
  const token = cookies['auth_token'];
  const account_id = cookies['account_id'];

  const url1 = window.location.origin + `/shotmaniacs2/api/admin/allcrew`
  let crewInfo = "";

  function getAllCrews() {
    fetch(url1, {
      headers: {
        'Authorization': `${token}`
      }
    })
            .then(response => response.json())
            .then(data => {
              data.forEach(crew => {
                crewInfo += `
                            <div class="crew-rectangle pad" id="${crew.id}">
                              <div class="crew-name">${crew.username}</div>
                              <div class="role-rectangle">
                                <p class="role-specifying">${crew.role}</p>
                              </div>
                              <div class="real-work-hours-rectangle">
                                <p class="real-hours">Working Hours: </p>
                              </div>
                              <div class="work-hours-rectangle">
                                <p class="hours" onclick="toggleRemove()">Remove</p>
                              </div>
                            </div>
                            `;
                document.getElementById("crews").innerHTML = crewInfo;
              })
            })
            .catch(error => {
              // Handle any errors
              console.error(error);
            });
  }

  function addCrew() {
    let addingContainer = "";
    addingContainer += `<div class="small-rectangle-crews-setting">
                                <p id="crews-in-box">New Crew's Information</p>
                            </div>
                            <div class="input-section">
                                <label for="editor">Username</label>
                                <input class="number-type" id="username" type="text">
                            </div>
                            <div class="input-section">
                                <label for="editor">Email</label>
                                <input class="number-type" id="email" type="text">
                            </div>
                            <div class="input-section">
                                <label for="editor">Password</label>
                                <input class="number-type" id="passwordForNewCrew" type="text">
                            </div>
                            <div class="input-section">
                                <label for="editor">Account Type</label>
                                <input class="number-type" id="accountType" type="text">
                            </div>
                            <div class="input-section">
                                <label for="editor">Role</label>
                                <input class="number-type" id="role" type="text">
                            </div>
                            <div class="footer" id="footer">
                                <div class="save-data-and-accept" id="save-data" onclick="saveData()">Save Data And Add Crew</div>
                            </div>
                          `;
    document.getElementById("adding-crew-here").innerHTML = addingContainer;
  }

  //TODO: change this due to the input in the form
  //TODO: add new account to database (update data to the database)
  //TODO: make it appear in the left side
  //REMEMBER to make innerHTML of crewInfo empty so that it can clear data, otherwise, a new form will appear right below the previous form
  function saveData() {
    crewInfo += `
                  <div class="crew-rectangle pad" id="${crew.id}">
                    <div class="crew-name">${crew.username}</div>
                    <div class="role-rectangle">
                      <p class="role-specifying">${crew.role}</p>
                    </div>
                    <div class="real-work-hours-rectangle">
                      <p class="real-hours">Working Hours: </p>
                    </div>
                    <div class="work-hours-rectangle">
                      <p class="hours" onclick="toggleRemove()">Remove</p>
                    </div>
                  </div>
                  `;
    document.getElementById("crews").innerHTML = crewInfo;
  }

  //TODO: update in the database
  function toggleRemove() {

  }
</script>
</body>
</html>