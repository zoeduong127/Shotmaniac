<!DOCTYPE html>
<html>
<head>
	<title>Announcement Scroll</title>
	<link rel="stylesheet" type="text/css" href="notifyStyles.css">
	<!--
	  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	-->
</head>
<body onload="readAllAnnouncements()">  <!-- here's it bunch of announcements, each with a title
 that needs to be edited regarding the actual announcements-->
<div class="container">
	
	<header>
		<div class="top">
			<i class="fas fa-user user-icon"></i>
			<p class="logout">
				<span class="fas fa-arrow-right-from-bracket exit"> <!-- TODO: FIND WORKING ICON -->
				Log out
			</span>
		</div>
		<div class="search-area">
			<div class="left">
				<div class="image">
					<img src="./../../Brand_Identity/images/Logo/Shotmaniacs_Logo_Black_MT.png" alt="Shotmaniacs">
				</div>
				<div class="text">
					<span class="slogan">Make Every Shot Count</span>
				</div>
			</div>
			
			<div class="search" id="search_ALL">
				<label for="search"></label>
				<input type="text" class="input" id="search" placeholder="Search for Bookings..."
				       onfocus="getAllBookings()">
				<button class="search-icon-btn" id="search-icon-btn">
				</button>
			</div>
		</div>
		
		<div class="navigation">
			<a href="./../dashboard/A_Dashboard.html">
				<div class="box" id="img" onclick=""></div>
			</a>
			<div class="box"><a href="./../news/notifications.html">Announcement</a></div>
			<div class="box"><a href="./../All_Bookings/booking/">Bookings</a></div>
			<div class="box"><a href="./../accounts/crew">Crews</a></div>
			<div class="box"><a href="./../All_Bookings/calendar/A_calendar.html">Calendar</a></div>
		</div>
	</header>
	
	
	<main>
		<div class="page-title">
			<div class="text">Notifications</div>
		</div>
		
		<div class="announcement-container">
			
			
			<div class="announcement-list">
				<div class="filter-container">
					<div class="filter-dropdown">
						<button class="filter-button">
							<img id="filter_img" src="./../../Brand_Identity/images/icons/black_filter_icon.png" alt="">
							Filter
						</button>
						<div class="filter-options">
							<a href="#" class="filter-option">Read</a>
							<a href="#" class="filter-option">Unread</a>
						</div>
					</div>
				</div>
				
				<div class="announcement-wrapper" id="announcement-wrapper"></div>
			</div>
			
			
			<div class="announcement-content" id="description"></div>
		</div>
	</main>
</div>

<script defer>
	let commentBox;
	let commentInput;
	let submitbutton;
	
	const cookies = parseCookie(document.cookie);
	const token = cookies['auth_token'];
	const account_id = cookies['account_id'];
	
	function parseCookie(cookieString) {
		const cookies = {};
		cookieString.split(';').forEach(cookie => {
			const [name, value] = cookie.trim().split('=');
			cookies[name] = decodeURIComponent(value);
		});
		return cookies;
	}
	
	function readAllAnnouncements() {
		const url = window.location.origin + `/shotmaniacs2/api/crew/${account_id}/news`;
		
		fetch(url, {
			headers: {
				'Authorization': `${token}`
			}
		})
				.then(response => response.json())
				.then(data => {
					let container = "";
					let description = "";
					let check = true;
					
					data.forEach(a => {
						container += `<div class="announcement-list-item" id="A_${a.id}" onclick="display(${a.id})">${a.title}</div>`;
						
						if (check) {
							description += `
							<div class="description-wrapper current_display" id="${a.id}">
			                    <h3 class="announcement-title">${a.title}</h3>
			
			                    <div id="announcement-description">${a.body}</div>
		                    </div>
		                    
		                     <div class="add-comment" id="add-comment" onclick="showComment()">Add a comment</div>
		                    `;
							
							check = false;
						} else {
							description += `
							<div class="description-wrapper" id="${a.id}">
			                    <h3 class="announcement-title">${a.title}</h3>
			
			                    <div id="announcement-description">${a.body}</div>
			
		                    </div>
                            `;
						}
						
						
						const submit = document.createElement("div");
						const label = document.createElement("label");
						const textarea = document.createElement("textarea");
						const button = document.createElement("button");
						const stupidWrapper = document.createElement("div");
						
						submit.className = "comment-box";
						submit.id = "comment-box";
						
						label.setAttribute("for", "comment-input");
						
						textarea.id = "comment-input";
						textarea.placeholder = "Type your comment here";
						
						button.id = "comment-submit";
						button.type = "submit";
						button.innerText = "Submit";
						button.addEventListener('click', closeComment);
						
						submit.appendChild(label)
						submit.appendChild(textarea)
						submit.appendChild(button);
						stupidWrapper.appendChild(submit);
						description += stupidWrapper.innerHTML;
					})
					console.log(container + ", " + description)
					document.getElementById("announcement-wrapper").innerHTML = container;
					document.getElementById("description").innerHTML = description;
				})
	}
	
	
	function showComment() {
		const comment = document.getElementById("add-comment");
		if (comment.innerHTML === "Add a comment") {
			comment.innerHTML = "Close comment box";
			commentInput = document.getElementById("comment-input");
			submitbutton = document.getElementById("comment-submit");
			submitbutton.addEventListener('click', closeComment);
			commentBox = document.getElementById("comment-box");
			
			
			commentBox.style.visibility = "visible";
			commentBox.style.display = "flex";
		} else {
			comment.innerHTML = "Add a comment";
			commentBox = document.getElementById("comment-box")
			commentBox.style.visibility = "hidden";
			commentBox.style.visibility = "none";
		}
	}
	
	
	function closeComment() {
		console.log("close Comment")
		
		const comment = commentInput.value.trim();
		if (comment !== "") {
			// Logic to handle the submitted comment
			console.log("Submitted comment:", comment);
			commentInput.value = "";
			
			document.getElementById("add-comment").innerHTML = "Add a comment";
			commentBox.style.visibility = "hidden";
			commentBox.style.display = "none";
		}
	}
	
	function display(id) {
		document.querySelector(".current_display").className = "description-wrapper";
		document.getElementById(id).classList.add("current_display");
	}
	
	
	function filterAnnouncement(state) {
		const url = window.location.origin + `/shotmaniacs2/api/crew/${account_id}/news/filter?status=${state};
	}

</script>
</body>
</html>
